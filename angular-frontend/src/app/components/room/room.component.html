<div class="room-container">
  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-large"></div>
    <p>Carregando sala...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="error-container">
    <h2>âŒ Erro</h2>
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="leaveRoom()">Voltar</button>
  </div>

  <!-- Room Content -->
  <div *ngIf="!loading && !error && room" class="room-content">
    
    <!-- Header -->
    <header class="room-header">
      <div class="header-left">
        <h1>ğŸ¬ {{ room?.room?.code || roomCode }}</h1>
        <button class="btn-copy" (click)="copyRoomCode()" title="Copiar cÃ³digo">
          ğŸ“‹
        </button>
      </div>
      <button class="btn-leave" (click)="leaveRoom()">Sair</button>
    </header>

    <!-- Winner (if finished) -->
    <div *ngIf="isFinished && room?.room?.winnerMovie" class="winner-section">
      <div class="winner-card">
        <div class="winner-icon">ğŸ†</div>
        <h2>Filme Vencedor!</h2>
        <h3>{{ room.room.winnerMovie.title }}</h3>
        <p *ngIf="room.room.winnerMovie.year">({{ room.room.winnerMovie.year }})</p>
        <p class="suggested-by">
          Sugerido por: <strong>{{ room.room.winnerMovie.suggestedBy.displayName }}</strong>
        </p>
      </div>
    </div>

    <div class="room-main">
      <!-- Left Column: Movies -->
      <div class="room-section movies-section">
        <h2>ğŸ¿ Filmes Sugeridos ({{ room?.movies?.length || 0 }})</h2>

        <!-- Add Movie Form (only if not finished) -->
        <div *ngIf="!isFinished" class="add-movie-form">
          <form [formGroup]="movieForm" (ngSubmit)="onAddMovie()">
            <div class="form-row">
              <input
                type="text"
                formControlName="title"
                class="form-control"
                placeholder="Nome do filme"
                [disabled]="addingMovie"
              />
              <input
                type="number"
                formControlName="year"
                class="form-control year-input"
                placeholder="Ano"
                [disabled]="addingMovie"
              />
              <button
                type="submit"
                class="btn btn-add"
                [disabled]="addingMovie || movieForm.invalid"
              >
                <span *ngIf="!addingMovie">â•</span>
                <span *ngIf="addingMovie" class="spinner-small"></span>
              </button>
            </div>
          </form>
        </div>

        <!-- Movies List -->
        <div class="movies-list">
          <div *ngIf="!room?.movies || room.movies.length === 0" class="empty-state">
            <p>Nenhum filme sugerido ainda</p>
            <p class="hint">Seja o primeiro a adicionar! ğŸ¬</p>
          </div>

          <div
            *ngFor="let movie of room?.movies"
            class="movie-card"
            [class.deleting]="deletingMovieId === movie.id"
          >
            <div class="movie-info">
              <h4>{{ movie.title }}</h4>
              <p *ngIf="movie.year" class="movie-year">{{ movie.year }}</p>
              <p class="movie-author">por {{ movie?.suggestedBy?.displayName }}</p>
            </div>
            <button
              *ngIf="!isFinished && (isHost || movie?.suggestedBy?.id === room?.currentUser?.id)"
              class="btn-delete"
              (click)="onDeleteMovie(movie.id)"
              [disabled]="deletingMovieId === movie.id"
            >
              ğŸ—‘ï¸
            </button>
          </div>
        </div>

        <!-- Finish Button (only host) -->
        <button
          *ngIf="!isFinished && isHost && room?.movies && room.movies.length > 0"
          class="btn btn-finish"
          (click)="onFinishRoom()"
          [disabled]="finishing"
        >
          <span *ngIf="!finishing">ğŸ² Sortear Vencedor</span>
          <span *ngIf="finishing">
            <span class="spinner-small"></span> Sorteando...
          </span>
        </button>
      </div>

      <!-- Right Column: Participants -->
      <div class="room-section participants-section">
        <h2>ğŸ‘¥ Participantes ({{ room?.users?.length || 0 }})</h2>
        
        <div class="participants-list">
          <div
            *ngFor="let user of room?.users"
            class="participant-card"
            [class.is-host]="user.role === 'HOST'"
            [class.is-you]="user.id === room?.currentUser?.id"
          >
            <div class="participant-avatar">
              {{ user?.displayName?.charAt(0)?.toUpperCase() }}
            </div>
            <div class="participant-info">
              <span class="participant-name">
                {{ user.displayName }}
                <span *ngIf="user.id === room?.currentUser?.id" class="badge-you">vocÃª</span>
              </span>
              <span *ngIf="user.role === 'HOST'" class="badge-host">ğŸ‘‘ Host</span>
            </div>
          </div>
        </div>

        <div class="room-info">
          <p><strong>Status:</strong> {{ isFinished ? 'âœ… Finalizada' : 'ğŸŸ¢ Ativa' }}</p>
          <p><strong>CÃ³digo:</strong> {{ room?.room?.code || roomCode }}</p>
        </div>
      </div>
    </div>

  </div>
</div>